<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRC6998 簽到系統</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link rel="stylesheet" href="style.css"> </head>
<body>
    <div id="app">
        <div id="icon" class="loader"></div>
        <div id="status">正在載入系統模組...</div>
    </div>
    <script>
        // 核心設定
const CONFIG = {
    LIFF_ID: '2008914307-JOMdlPxS',
    GAS_URL: 'https://script.google.com/macros/s/AKfycbweyZJrAhuROVhNcVZ0_-PydK-KdMOFnO8jx9RSaSq0MwKaQDNBokTsWRvTNdSJsqZwvw/exec',
    // 50碼複雜Token
    TOKEN: 'v9E4kP2wR7zM5nB8xL1qQ6jT3hY9sD4fG7kH2mN5bV8cX1zQ3w' 
};

async function main() {
    try {
        await liff.init({ liffId: CONFIG.LIFF_ID });
        if (!liff.isLoggedIn()) { liff.login(); return; }

        navigator.geolocation.getCurrentPosition(async (pos) => {
            const profile = await liff.getProfile();
            document.getElementById('status').innerText = "位置驗證成功，傳送加密資料...";

            fetch(CONFIG.GAS_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({
                    token: CONFIG.TOKEN, // 送出50碼Token
                    userId: profile.userId,
                    userName: profile.displayName,
                    lat: pos.coords.latitude,
                    lng: pos.coords.longitude
                })
            }).then(() => {
                document.getElementById('icon').style.display = 'none';
                document.getElementById('status').innerHTML = "<h2>✅ 簽到已完成</h2>";
                setTimeout(() => { liff.closeWindow(); }, 2000);
            });
        }, (err) => {
            document.getElementById('status').innerHTML = "❌ 權限錯誤：請開啟 GPS 定位";
        }, { enableHighAccuracy: true });
    } catch (err) {
        document.getElementById('status').innerText = "系統錯誤：" + err;
    }
}

main();
    </script>
</body>
</html>

